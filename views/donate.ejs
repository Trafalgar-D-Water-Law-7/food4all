<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Restoran - Bootstrap Restaurant Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">
    <%- include('config/export') %>
        <style>
            .error {
                color: red;
                font-size: 14px;
                display: none;
            }
        </style>
</head>

<body>
    <div class="container-xxl bg-white p-0">
        <!-- Navbar & Hero Start -->
        <div class="container-xxl position-relative p-0">
            <%- include('config/nav') %>
                <div class="container-xxl py-5 bg-dark hero-header mb-5">
                    <div class="container text-center my-5 pt-5 pb-4">
                        <h1 class="display-3 text-white mb-3 animated slideInDown">Donate Food</h1>
                    </div>
                </div>
        </div>
        <!-- Navbar & Hero End -->

        <!-- Donation Form Start -->
        <div class="container-xxl py-5">
            <div class="container">
                <div class="row g-4 align-items-center">
                    <!-- Left: Donation Form -->
                    <div class="col-md-6">
                        <div class="wow fadeInUp" data-wow-delay="0.2s">
                            <h3 class="mb-4 text-primary">üçõ Share a Meal. Spread Kindness.</h3>
                            <p class="text-muted mb-4">Fill in the details below to donate leftover or extra food. Your
                                small effort can make a big difference in someone's life.</p>

                            <form action="/users/donate" enctype="multipart/form-data" method="post" id="donationForm"
                                novalidate>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="name" placeholder="Your Name"
                                                value="<%=user.name%>" name="name" readonly>
                                            <label for="name">Your Name</label>
                                            <small class="error" id="nameError">Name is required</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="email" class="form-control" id="email" placeholder="Your Email"
                                                value="<%=user.email%>" name="email" readonly>
                                            <label for="email">Your Email</label>
                                            <small class="error" id="emailError">Valid email is required</small>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="subject" placeholder="Subject"
                                                name="subject">
                                            <label for="subject">Title for the Food (e.g. "10 Veg Meals")</label>
                                            <small class="error" id="subjectError">Title is required</small>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-floating">
                                            <textarea class="form-control" placeholder="Leave a message here"
                                                id="message" name="message" style="height: 150px"></textarea>
                                            <label for="message">Description (e.g. contents, condition, special
                                                notes)</label>
                                            <small class="error" id="messageError">Description is required</small>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="expiryTime"
                                                placeholder="Expiry Time (in hours)" name="expiryTime" required>
                                            <label for="expiryTime">Expiry Time (in hours)</label>
                                            <small class="error" id="expiryTimeError">Expiry time is required</small>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="file" class="form-control" id="photoInput" accept="image/*"
                                                capture="environment" name="photos" multiple>
                                            <label for="photoInput">Capture Up to 5 Photos</label>
                                            <div id="previewContainer"
                                                class="d-flex flex-wrap justify-content-left gap-2 mt-3"></div>
                                            <small class="error" id="photoError">At least one photo is required</small>
                                        </div>
                                    </div>

                            
                              
                                    <input type="text" name="latitude" id="latitude">
                                    <input type="text" name="longitude" id="longitude">

                                        
                                        

                                    <input type="text" name="donor" value="<%= user._id %>">

                                    <div class="col-12">
                                        <button class="btn btn-primary w-100 py-3" type="submit">Donate Now</button>
                                    </div>

                                    <div class="col-12 text-muted small text-center">
                                        üìç Location will be captured automatically for nearby pickup.
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Right: Static Image and Info -->
                    <div class="col-md-6 text-center">
                        <img src="/img/about-2.jpg" alt="Donate Food" class="img-fluid rounded shadow"
                            style="max-height: 500px; object-fit: cover;">
                        <div class="mt-4 px-3">
                            <h4 class="text-dark fw-bold">ü•ó Feed the Hungry</h4>
                            <p class="mb-2">Every meal you donate helps someone avoid going to bed hungry.</p>
                            <p class="text-muted fst-italic">‚ÄúIf you can‚Äôt feed a hundred people, then feed just one.‚Äù ‚Äì
                                Mother Teresa</p>

                            <div class="d-inline-block mt-3 px-4 py-2 bg-light rounded shadow-sm">
                                <strong>‚úÖ Meals Donated So Far: <%=totalDonations%></strong>

                            </div>



                            <!-- CTA -->
                            <div class="mt-3">
                                <a href="/about" class="btn btn-outline-primary btn-sm">Learn How You Help ‚ûú</a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>


        <%- include('config/footer') %>
    </div>


    <!-- JavaScript for Image Preview -->
    <!-- Bootstrap JS (for modal functionality) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


    <script>
        // Try to get browser GPS location
        navigator.geolocation.getCurrentPosition(
          position => {
            document.getElementById('latitude').value = position.coords.latitude;
            document.getElementById('longitude').value = position.coords.longitude;
          },
          error => {
            console.warn("Geolocation blocked. Falling back to IP...");
            // Fallback using IP
            fetch('https://ipapi.co/json/')
              .then(res => res.json())
              .then(data => {
                document.getElementById('latitude').value = data.latitude;
                document.getElementById('longitude').value = data.longitude;
              })
              .catch(err => console.error("IP location error:", err));
          }
        );
      </script>

    <script>
        // Function to validate form fields
        function validateField(inputElement, errorElement, validationFn) {
            inputElement.addEventListener("input", function () {
                if (validationFn(inputElement.value)) {
                    errorElement.style.display = "none";
                    inputElement.classList.remove("is-invalid");
                } else {
                    errorElement.style.display = "block";
                    inputElement.classList.add("is-invalid");
                }
            });
        }

        // Validation functions for each field
        function isNotEmpty(value) {
            return value.trim() !== "";
        }

        function isValidEmail(value) {
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return emailPattern.test(value);
        }

        function isNumber(value) {
            return !isNaN(value) && value.trim() !== "";
        }

        function isValidFile(value) {
            return value.trim() !== "";
        }

        // Apply validation to each form field
        document.addEventListener("DOMContentLoaded", function () {
            // Name field validation
            validateField(document.getElementById("name"), document.getElementById("nameError"), isNotEmpty);

            // Email field validation
            validateField(document.getElementById("email"), document.getElementById("emailError"), isValidEmail);

            // Subject field validation
            validateField(document.getElementById("subject"), document.getElementById("subjectError"), isNotEmpty);

            // Message field validation
            validateField(document.getElementById("message"), document.getElementById("messageError"), isNotEmpty);

            // Expiry time validation
            validateField(document.getElementById("expiryTime"), document.getElementById("expiryTimeError"), isNumber);

            // File field validation (at least one file should be selected)
            document.getElementById("photoInput").addEventListener("change", function () {
                const errorElement = document.getElementById("photoError");
                if (this.files.length > 0) {
                    errorElement.style.display = "none";
                } else {
                    errorElement.style.display = "block";
                }
            });

            // Form submission validation
            document.getElementById("donationForm").addEventListener("submit", function (e) {
                // Trigger validation on submit
                let isValid = true;

                // Validate all fields
                if (!isNotEmpty(document.getElementById("name").value)) {
                    isValid = false;
                    document.getElementById("nameError").style.display = "block";
                }

                if (!isValidEmail(document.getElementById("email").value)) {
                    isValid = false;
                    document.getElementById("emailError").style.display = "block";
                }

                if (!isNotEmpty(document.getElementById("subject").value)) {
                    isValid = false;
                    document.getElementById("subjectError").style.display = "block";
                }

                if (!isNotEmpty(document.getElementById("message").value)) {
                    isValid = false;
                    document.getElementById("messageError").style.display = "block";
                }

                if (!isNumber(document.getElementById("expiryTime").value)) {
                    isValid = false;
                    document.getElementById("expiryTimeError").style.display = "block";
                }

                if (document.getElementById("photoInput").files.length === 0) {
                    isValid = false;
                    document.getElementById("photoError").style.display = "block";
                }

                // If not valid, prevent form submission
                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    </script>









    <script>
        // Image Preview Script
        document.addEventListener("DOMContentLoaded", function () {
            const photoInput = document.getElementById("photoInput");
            const previewContainer = document.getElementById("previewContainer");

            photoInput.addEventListener("change", function () {
                previewContainer.innerHTML = ""; // Clear previous images
                const files = photoInput.files;

                if (files.length > 5) {
                    alert("You can upload up to 5 photos only.");
                    photoInput.value = ""; // Reset input
                    return;
                }

                Array.from(files).forEach(file => {
                    if (file.type.startsWith("image/")) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const img = document.createElement("img");
                            img.src = e.target.result;
                            img.style.width = "120px";
                            img.style.height = "120px";
                            img.style.objectFit = "cover";
                            img.style.borderRadius = "8px";
                            img.style.boxShadow = "0 2px 8px rgba(0, 0, 0, 0.2)";
                            previewContainer.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        });
    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>