<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Restoran - Bootstrap Restaurant Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">
    <%- include('config/export') %>
</head>

<body>

    <div class="container-xxl bg-white p-0">

        <!-- Navbar & Hero Start -->
        <div class="container-xxl position-relative p-0">
            <%- include('config/nav') %>

                <div class="container-xxl py-5 bg-dark hero-header mb-5">
                    <div class="container text-center my-5 pt-5 pb-4">
                        <h1 class="display-3 text-white mb-3 animated slideInDown">Sign Up </h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb justify-content-center text-uppercase">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item"><a href="#">Pages</a></li>
                                <li class="breadcrumb-item text-white active" aria-current="page">Sign Up</li>
                            </ol>
                        </nav>
                    </div>
                </div>
        </div>
        <!-- Navbar & Hero End -->

        <div class="container-xxl py-5">
            <div class="container">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="wow fadeInUp" data-wow-delay="0.2s">
                            <form id="signupForm" action="/users/signup" method="post" enctype="multipart/form-data">
                                <input type="hidden" name="latitude" id="latitude">
                                <input type="hidden" name="longitude" id="longitude">

                                <div class="row g-3">
                                    <!-- Name Field -->
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="name" name="name"
                                                placeholder="Your Name" required>
                                            <label for="name">Your Name</label>
                                        </div>
                                        <small class="text-danger" id="nameError"></small>
                                    </div>

                                    <!-- Email Field -->
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="email" class="form-control" id="email" name="email"
                                                placeholder="Your Email" required>
                                            <label for="email">Your Email</label>
                                        </div>
                                        <small class="text-danger" id="emailError"></small>
                                    </div>

                                    <!-- Password Field -->
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="password" name="password" class="form-control" id="password"
                                                placeholder="Your Password" required>
                                            <label for="password">Password</label>
                                        </div>
                                        <small class="text-danger" id="passwordError"></small>
                                    </div>

                                    <!-- Confirm Password Field -->
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="password" name="confirm_password" class="form-control"
                                                id="confirmPassword" placeholder="Confirm Password" required>
                                            <label for="confirmPassword">Confirm Password</label>
                                        </div>
                                        <small class="text-danger" id="confirmPasswordError"></small>
                                    </div>

                                    <!-- Contact Field -->
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="tel" class="form-control" id="contact"
                                                placeholder="Contact Number" required>
                                            <input type="hidden" name="contact" id="full_phone">

                                        </div>
                                        <small class="text-danger" id="contactError"></small>
                                    </div>
                                    <!-- Street -->
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="street" name="street"
                                                placeholder="Street" required>
                                            <label for="street">Street</label>
                                        </div>
                                        <small class="text-danger" id="streetError"></small>
                                    </div>


                                    <!-- Photo Upload -->
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="file" name="photo" class="form-control" id="photoInput"
                                                accept="image/*" required>
                                            <label for="photoInput">Upload Photo</label>
                                        </div>
                                        <small class="text-danger" id="photoError"></small>
                                    </div>

                                    <!-- Submit Button -->
                                    <div class="col-12">
                                        <button class="btn btn-primary w-100 py-3" type="submit">Sign Up</button>
                                    </div>
                                </div>
                            </form>



                        </div>
                    </div>

                    <!-- Right Side Image Preview -->
                    <div class="col-md-6 wow fadeIn" data-wow-delay="0.1s">
                        <div class="images text-center">
                            <p>Captured Image Will Appear Here</p>
                            <div id="previewContainer" class="d-flex justify-content-center">
                                <img id="imagePreview" src="" alt="Image Preview"
                                    style="display: none; max-width: 100%; height: auto;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Modal Structure -->
        <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="successModalLabel">Success</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        User successfully created!
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trigger button for the modal -->
        <!-- You don't need this button since we're triggering it programmatically -->

        <script>
            // Get file input and preview container
            const photoInput = document.getElementById("photoInput");
            const previewContainer = document.getElementById("previewContainer");
            const imagePreview = document.getElementById("imagePreview");

            // Event listener for file input
            photoInput.addEventListener("change", function (event) {
                // Clear previous preview
                previewContainer.innerHTML = '';

                // Ensure only one image is selected
                const file = event.target.files[0];
                if (file && file.type.startsWith("image/")) {
                    // Create an image element to display the preview
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';  // Show the image
                        previewContainer.appendChild(imagePreview); // Append image to preview container
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert("Please upload a valid image.");
                }
            });
        </script>

        <script>
            // Get the user's location and set it in the hidden input fields
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    document.getElementById("latitude").value = position.coords.latitude;
                    document.getElementById("longitude").value = position.coords.longitude;
                });
            }
        </script>




        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const form = document.getElementById("signupForm");

                // Input fields
                const name = document.getElementById("name");
                const email = document.getElementById("email");
                const password = document.getElementById("password");
                const confirmPassword = document.getElementById("confirmPassword");
                const contact = document.getElementById("contact");
                const photo = document.getElementById("photoInput");
                const street = document.getElementById("street");
                const country = document.getElementById("country");
                const city = document.getElementById("city");

                // Error message elements
                const nameError = document.getElementById("nameError");
                const emailError = document.getElementById("emailError");
                const passwordError = document.getElementById("passwordError");
                const confirmPasswordError = document.getElementById("confirmPasswordError");
                const contactError = document.getElementById("contactError");
                const photoError = document.getElementById("photoError");
                const streetError = document.getElementById("streetError");




                // Validate if input contains only letters
                function isValidString(value) {
                    return /^[A-Za-z\s]+$/.test(value);
                }

                function validateName() {
                    if (!isValidString(name.value.trim())) {
                        nameError.textContent = "Name must contain only letters.";
                    } else {
                        nameError.textContent = "";
                    }
                }

                function validateEmail() {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email.value)) {
                        emailError.textContent = "Enter a valid email address.";
                    } else {
                        emailError.textContent = "";
                    }
                }

                function validatePassword() {
                    const passwordRegex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*()_+])[A-Za-z\d!@#$%^&*()_+]{8,}$/;
                    if (!passwordRegex.test(password.value)) {
                        passwordError.textContent = "Password must be at least 8 characters long, contain at least one uppercase letter, one number, and one special character.";
                    } else {
                        passwordError.textContent = "";
                    }
                }


                function validateConfirmPassword() {
                    if (confirmPassword.value !== password.value) {
                        confirmPasswordError.textContent = "Passwords do not match.";
                    } else {
                        confirmPasswordError.textContent = "";
                    }
                }

                function validateContact() {
                    const contactRegex = /^[0-9]{10}$/;
                    if (!contactRegex.test(contact.value)) {
                        contactError.textContent = "Enter a valid 10-digit contact number.";
                    } else {
                        contactError.textContent = "";
                    }
                }

                function validatePhoto() {
                    if (!photo.files.length) {
                        photoError.textContent = "Please upload a photo.";
                    } else {
                        photoError.textContent = "";
                    }
                }

                function validateStreet() {
                    if (street.value.trim().length < 5) {
                        streetError.textContent = "Street name must be at least 5 characters.";
                    } else {
                        streetError.textContent = "";
                    }
                }

                async function handleSignup(event) {
                    event.preventDefault(); // Prevent the default form submission

                    // Collect form data
                    const formData = new FormData(event.target);

                    try {
                        const response = await fetch('/users/signup', {
                            method: 'POST',
                            body: formData,
                        });

                        if (response.ok) {
                            // Show a success popup
                            alert('User successfully created!');
                        } else {
                            // Handle errors (e.g., email already in use)
                            const data = await response.json();
                            alert(data.message || 'Something went wrong.');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('An error occurred during signup.');
                    }
                }
                // Event listeners for real-time validation
                name.addEventListener("input", validateName);
                email.addEventListener("input", validateEmail);
                password.addEventListener("input", validatePassword);
                confirmPassword.addEventListener("input", validateConfirmPassword);
                contact.addEventListener("input", validateContact);
                photo.addEventListener("change", validatePhoto);
                street.addEventListener("input", validateStreet);
                country.addEventListener("change", validateCountry);



                form.addEventListener("submit", function (event) {
                    validateName();
                    validateEmail();
                    validateCountry();
                    validatePassword();
                    validateConfirmPassword();
                    validateContact();
                    validatePhoto();

                    // Prevent form submission if there are validation errors
                    if (nameError.textContent || emailError.textContent || passwordError.textContent || confirmPasswordError.textContent || contactError.textContent || photoError.textContent) {
                        event.preventDefault();
                    }
                });
            });
        </script>


        <!-- phone number with country code -->
        <script>
            var input = document.querySelector("#contact");
            var iti = window.intlTelInput(input, {
                separateDialCode: true,
                preferredCountries: ["np", "us", "gb"],
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
            });

            document.querySelector("form").addEventListener("submit", function () {
                document.querySelector("#full_phone").value = iti.getNumber();
            });
        </script>


        <%- include('config/footer')%>

</body>

</html>